import { User, Subject, Group, SubjectAssignment, Task } from '../models/index.ts';

async function seedTeacherData() {
  try {
    console.log('üå± Iniciando seed de datos para profesores...');

    // 1. Crear/buscar profesores
    console.log('üë®‚Äçüè´ Creando profesores...');
    const teachers = await Promise.all([
      User.findOrCreate({
        where: { email: 'profesor@colegio.edu' },
        defaults: {
          email: 'profesor@colegio.edu',
          firstName: 'Carlos',
          lastName: 'Rodr√≠guez',
          role: 'teacher',
          isActive: true
        }
      }),
      User.findOrCreate({
        where: { email: 'ingles@colegio.edu' },
        defaults: {
          email: 'ingles@colegio.edu',
          firstName: 'Mar√≠a',
          lastName: 'Garc√≠a',
          role: 'teacher',
          isActive: true
        }
      }),
      User.findOrCreate({
        where: { email: 'historia@colegio.edu' },
        defaults: {
          email: 'historia@colegio.edu',
          firstName: 'Jos√©',
          lastName: 'Mart√≠nez',
          role: 'teacher',
          isActive: true
        }
      }),
      User.findOrCreate({
        where: { email: 'educacionfisica@colegio.edu' },
        defaults: {
          email: 'educacionfisica@colegio.edu',
          firstName: 'Ana',
          lastName: 'L√≥pez',
          role: 'teacher',
          isActive: true
        }
      }),
      User.findOrCreate({
        where: { email: 'arte@colegio.edu' },
        defaults: {
          email: 'arte@colegio.edu',
          firstName: 'Luis',
          lastName: 'Fern√°ndez',
          role: 'teacher',
          isActive: true
        }
      }),
      User.findOrCreate({
        where: { email: 'biologia@colegio.edu' },
        defaults: {
          email: 'biologia@colegio.edu',
          firstName: 'Carmen',
          lastName: 'Ruiz',
          role: 'teacher',
          isActive: true
        }
      })
    ]);

    const teacher = teachers[0][0];
    const englishTeacher = teachers[1][0];
    const historyTeacher = teachers[2][0];
    const peTeacher = teachers[3][0];
    const artTeacher = teachers[4][0];
    const biologyTeacher = teachers[5][0];

    console.log('‚úÖ Profesores creados/encontrados');

    // 2. Crear materias
    console.log('üìö Creando materias...');
    const subjects = await Promise.all([
      Subject.findOrCreate({
        where: { name: 'Matem√°ticas' },
        defaults: {
          name: 'Matem√°ticas',
          code: 'MAT',
          description: 'Matem√°ticas para educaci√≥n secundaria',
          isActive: true
        }
      }),
      Subject.findOrCreate({
        where: { name: 'F√≠sica' },
        defaults: {
          name: 'F√≠sica',
          code: 'FIS',
          description: 'F√≠sica para educaci√≥n secundaria',
          isActive: true
        }
      }),
      Subject.findOrCreate({
        where: { name: 'Qu√≠mica' },
        defaults: {
          name: 'Qu√≠mica',
          code: 'QUI',
          description: 'Qu√≠mica para educaci√≥n secundaria',
          isActive: true
        }
      }),
      Subject.findOrCreate({
        where: { name: 'Ingl√©s' },
        defaults: {
          name: 'Ingl√©s',
          code: 'ENG',
          description: 'Ingl√©s como lengua extranjera',
          isActive: true
        }
      }),
      Subject.findOrCreate({
        where: { name: 'Historia' },
        defaults: {
          name: 'Historia',
          code: 'HIS',
          description: 'Historia universal y nacional',
          isActive: true
        }
      }),
      Subject.findOrCreate({
        where: { name: 'Educaci√≥n F√≠sica' },
        defaults: {
          name: 'Educaci√≥n F√≠sica',
          code: 'EDF',
          description: 'Educaci√≥n f√≠sica y deportes',
          isActive: true
        }
      }),
      Subject.findOrCreate({
        where: { name: 'Arte' },
        defaults: {
          name: 'Arte',
          code: 'ART',
          description: 'Artes pl√°sticas y visuales',
          isActive: true
        }
      }),
      Subject.findOrCreate({
        where: { name: 'Biolog√≠a' },
        defaults: {
          name: 'Biolog√≠a',
          code: 'BIO',
          description: 'Biolog√≠a y ciencias naturales',
          isActive: true
        }
      })
    ]);

    const matematicas = subjects[0][0];
    const fisica = subjects[1][0];
    const quimica = subjects[2][0];
    const ingles = subjects[3][0];
    const historia = subjects[4][0];
    const educacionFisica = subjects[5][0];
    const arte = subjects[6][0];
    const biologia = subjects[7][0];

    console.log('‚úÖ Materias creadas/encontradas');

    // 3. Crear grupos
    console.log('üë• Creando grupos...');
    const groups = await Promise.all([
      Group.findOrCreate({
        where: { name: '10A' },
        defaults: {
          name: '10A',
          grade: '10',
          section: 'A',
          academicYear: '2024-2025',
          studentCount: 25,
          isActive: true
        }
      }),
      Group.findOrCreate({
        where: { name: '10B' },
        defaults: {
          name: '10B',
          grade: '10',
          section: 'B',
          academicYear: '2024-2025',
          studentCount: 28,
          isActive: true
        }
      }),
      Group.findOrCreate({
        where: { name: '11A' },
        defaults: {
          name: '11A',
          grade: '11',
          section: 'A',
          academicYear: '2024-2025',
          studentCount: 22,
          isActive: true
        }
      })
    ]);

    const group10A = groups[0][0];
    const group10B = groups[1][0];
    const group11A = groups[2][0];

    console.log('‚úÖ Grupos creados/encontrados');

    // 4. Crear asignaciones de materias a profesores
    console.log('üîó Creando asignaciones de materias...');
    const assignments = [
      // Carlos Rodr√≠guez - Matem√°ticas, F√≠sica, Qu√≠mica
      { userId: teacher.id, subjectId: matematicas.id, groupId: group10A.id, academicYear: '2024-2025' },
      { userId: teacher.id, subjectId: matematicas.id, groupId: group10B.id, academicYear: '2024-2025' },
      { userId: teacher.id, subjectId: matematicas.id, groupId: group11A.id, academicYear: '2024-2025' },
      { userId: teacher.id, subjectId: fisica.id, groupId: group10A.id, academicYear: '2024-2025' },
      { userId: teacher.id, subjectId: fisica.id, groupId: group11A.id, academicYear: '2024-2025' },
      { userId: teacher.id, subjectId: quimica.id, groupId: group10B.id, academicYear: '2024-2025' },
      { userId: teacher.id, subjectId: quimica.id, groupId: group11A.id, academicYear: '2024-2025' },
      
      // Mar√≠a Garc√≠a - Ingl√©s para todos los grupos
      { userId: englishTeacher.id, subjectId: ingles.id, groupId: group10A.id, academicYear: '2024-2025' },
      { userId: englishTeacher.id, subjectId: ingles.id, groupId: group10B.id, academicYear: '2024-2025' },
      { userId: englishTeacher.id, subjectId: ingles.id, groupId: group11A.id, academicYear: '2024-2025' },
      
      // Jos√© Mart√≠nez - Historia para todos los grupos
      { userId: historyTeacher.id, subjectId: historia.id, groupId: group10A.id, academicYear: '2024-2025' },
      { userId: historyTeacher.id, subjectId: historia.id, groupId: group10B.id, academicYear: '2024-2025' },
      { userId: historyTeacher.id, subjectId: historia.id, groupId: group11A.id, academicYear: '2024-2025' },
      
      // Ana L√≥pez - Educaci√≥n F√≠sica para todos los grupos
      { userId: peTeacher.id, subjectId: educacionFisica.id, groupId: group10A.id, academicYear: '2024-2025' },
      { userId: peTeacher.id, subjectId: educacionFisica.id, groupId: group10B.id, academicYear: '2024-2025' },
      { userId: peTeacher.id, subjectId: educacionFisica.id, groupId: group11A.id, academicYear: '2024-2025' },
      
      // Luis Fern√°ndez - Arte para 10A y 10B
      { userId: artTeacher.id, subjectId: arte.id, groupId: group10A.id, academicYear: '2024-2025' },
      { userId: artTeacher.id, subjectId: arte.id, groupId: group10B.id, academicYear: '2024-2025' },
      
      // Carmen Ruiz - Biolog√≠a para 11A
      { userId: biologyTeacher.id, subjectId: biologia.id, groupId: group11A.id, academicYear: '2024-2025' }
    ];

    for (const assignment of assignments) {
      await SubjectAssignment.findOrCreate({
        where: assignment,
        defaults: { ...assignment, isActive: true }
      });
    }

    console.log('‚úÖ Asignaciones creadas');

    // 5. Crear tareas con fechas espec√≠ficas para probar el calendario
    console.log('üìù Creando tareas...');
    const tasks = [
      // Tareas para diciembre 2024
      {
        title: 'Tarea de √Ålgebra',
        description: 'Resolver ejercicios de ecuaciones lineales del cap√≠tulo 5',
        dueDate: new Date('2024-12-15T23:59:59'),
        status: 'pending',
        priority: 'medium',
        userId: teacher.id,
        subjectId: matematicas.id,
        groupId: group10A.id
      },
      {
        title: 'Laboratorio de Mec√°nica',
        description: 'Informe del experimento de ca√≠da libre',
        dueDate: new Date('2024-12-15T23:59:59'), // Mismo d√≠a para probar color rojo
        status: 'pending',
        priority: 'high',
        userId: teacher.id,
        subjectId: fisica.id,
        groupId: group10A.id
      },
      {
        title: 'Pr√°ctica de Qu√≠mica Org√°nica',
        description: 'Identificaci√≥n de grupos funcionales',
        dueDate: new Date('2024-12-20T23:59:59'),
        status: 'pending',
        priority: 'medium',
        userId: teacher.id,
        subjectId: quimica.id,
        groupId: group10B.id
      },
      {
        title: 'Examen de Geometr√≠a',
        description: 'Evaluaci√≥n de tri√°ngulos y c√≠rculos',
        dueDate: new Date('2024-12-22T23:59:59'),
        status: 'pending',
        priority: 'high',
        userId: teacher.id,
        subjectId: matematicas.id,
        groupId: group11A.id
      },
      // Tareas para enero 2025
      {
        title: 'Proyecto de F√≠sica Moderna',
        description: 'Investigaci√≥n sobre teor√≠a cu√°ntica',
        dueDate: new Date('2025-01-10T23:59:59'),
        status: 'pending',
        priority: 'high',
        userId: teacher.id,
        subjectId: fisica.id,
        groupId: group11A.id
      },
      {
        title: 'Laboratorio de Reacciones Qu√≠micas',
        description: 'An√°lisis de velocidad de reacci√≥n',
        dueDate: new Date('2025-01-12T23:59:59'),
        status: 'pending',
        priority: 'medium',
        userId: teacher.id,
        subjectId: quimica.id,
        groupId: group11A.id
      },
      {
        title: 'Tarea de C√°lculo',
        description: 'Derivadas e integrales b√°sicas',
        dueDate: new Date('2025-01-15T23:59:59'),
        status: 'pending',
        priority: 'medium',
        userId: teacher.id,
        subjectId: matematicas.id,
        groupId: group11A.id
      },
      {
        title: 'Ensayo de Termodin√°mica',
        description: 'An√°lisis de las leyes de la termodin√°mica',
        dueDate: new Date('2025-01-18T23:59:59'),
        status: 'pending',
        priority: 'low',
        userId: teacher.id,
        subjectId: fisica.id,
        groupId: group10A.id
      },
      
      // ===== TAREAS PARA SEPTIEMBRE 2025 =====
      // Grupo 10A - Septiembre 2025
      {
        title: 'Essay: My Summer Vacation',
        description: 'Write a 300-word essay about your summer vacation in English',
        dueDate: new Date('2025-09-05T23:59:59'),
        status: 'pending',
        priority: 'medium',
        userId: englishTeacher.id,
        subjectId: ingles.id,
        groupId: group10A.id
      },
      {
        title: 'Revoluci√≥n Industrial',
        description: 'Investigaci√≥n sobre las causas y consecuencias de la Revoluci√≥n Industrial',
        dueDate: new Date('2025-09-08T23:59:59'),
        status: 'pending',
        priority: 'high',
        userId: historyTeacher.id,
        subjectId: historia.id,
        groupId: group10A.id
      },
      {
        title: 'Evaluaci√≥n F√≠sica - Resistencia',
        description: 'Prueba de resistencia cardiovascular - 12 minutos de Cooper',
        dueDate: new Date('2025-09-12T23:59:59'),
        status: 'pending',
        priority: 'medium',
        userId: peTeacher.id,
        subjectId: educacionFisica.id,
        groupId: group10A.id
      },
      {
        title: 'Proyecto de Pintura',
        description: 'Crear una obra de arte usando t√©cnicas de acuarela',
        dueDate: new Date('2025-09-16T23:59:59'),
        status: 'pending',
        priority: 'low',
        userId: artTeacher.id,
        subjectId: arte.id,
        groupId: group10A.id
      },
      {
        title: 'Ecuaciones Cuadr√°ticas',
        description: 'Resolver problemas de ecuaciones cuadr√°ticas del cap√≠tulo 3',
        dueDate: new Date('2025-09-20T23:59:59'),
        status: 'pending',
        priority: 'high',
        userId: teacher.id,
        subjectId: matematicas.id,
        groupId: group10A.id
      },
      {
        title: 'Laboratorio de Cinem√°tica',
        description: 'An√°lisis del movimiento rectil√≠neo uniforme',
        dueDate: new Date('2025-09-25T23:59:59'),
        status: 'pending',
        priority: 'medium',
        userId: teacher.id,
        subjectId: fisica.id,
        groupId: group10A.id
      },
      
      // Grupo 10B - Septiembre 2025
      {
        title: 'Vocabulary Test: Unit 2',
        description: 'Test on vocabulary from Unit 2: Daily Routines',
        dueDate: new Date('2025-09-03T23:59:59'),
        status: 'pending',
        priority: 'high',
        userId: englishTeacher.id,
        subjectId: ingles.id,
        groupId: group10B.id
      },
      {
        title: 'Civilizaciones Antiguas',
        description: 'Ensayo comparativo entre Egipto y Mesopotamia',
        dueDate: new Date('2025-09-10T23:59:59'),
        status: 'pending',
        priority: 'medium',
        userId: historyTeacher.id,
        subjectId: historia.id,
        groupId: group10B.id
      },
      {
        title: 'Torneo de Voleibol',
        description: 'Participaci√≥n en el torneo inter-aulas de voleibol',
        dueDate: new Date('2025-09-15T23:59:59'),
        status: 'pending',
        priority: 'low',
        userId: peTeacher.id,
        subjectId: educacionFisica.id,
        groupId: group10B.id
      },
      {
        title: 'Escultura en Arcilla',
        description: 'Crear una escultura peque√±a usando t√©cnicas b√°sicas de modelado',
        dueDate: new Date('2025-09-18T23:59:59'),
        status: 'pending',
        priority: 'medium',
        userId: artTeacher.id,
        subjectId: arte.id,
        groupId: group10B.id
      },
      {
        title: 'Funciones Lineales',
        description: 'Graficar y analizar funciones lineales',
        dueDate: new Date('2025-09-22T23:59:59'),
        status: 'pending',
        priority: 'high',
        userId: teacher.id,
        subjectId: matematicas.id,
        groupId: group10B.id
      },
      {
        title: 'Pr√°ctica de Qu√≠mica Inorg√°nica',
        description: 'Identificaci√≥n de sales y √°cidos en el laboratorio',
        dueDate: new Date('2025-09-28T23:59:59'),
        status: 'pending',
        priority: 'medium',
        userId: teacher.id,
        subjectId: quimica.id,
        groupId: group10B.id
      },
      
      // Grupo 11A - Septiembre 2025
      {
        title: 'Literature Analysis: Romeo and Juliet',
        description: 'Character analysis of the main protagonists',
        dueDate: new Date('2025-09-06T23:59:59'),
        status: 'pending',
        priority: 'high',
        userId: englishTeacher.id,
        subjectId: ingles.id,
        groupId: group11A.id
      },
      {
        title: 'Segunda Guerra Mundial',
        description: 'An√°lisis de las causas y consecuencias de la Segunda Guerra Mundial',
        dueDate: new Date('2025-09-11T23:59:59'),
        status: 'pending',
        priority: 'high',
        userId: historyTeacher.id,
        subjectId: historia.id,
        groupId: group11A.id
      },
      {
        title: 'Plan de Entrenamiento Personal',
        description: 'Dise√±ar un plan de entrenamiento personalizado de 4 semanas',
        dueDate: new Date('2025-09-14T23:59:59'),
        status: 'pending',
        priority: 'medium',
        userId: peTeacher.id,
        subjectId: educacionFisica.id,
        groupId: group11A.id
      },
      {
        title: 'Ecosistemas y Biodiversidad',
        description: 'Investigaci√≥n sobre un ecosistema local y su biodiversidad',
        dueDate: new Date('2025-09-17T23:59:59'),
        status: 'pending',
        priority: 'high',
        userId: biologyTeacher.id,
        subjectId: biologia.id,
        groupId: group11A.id
      },
      {
        title: 'L√≠mites y Continuidad',
        description: 'Ejercicios de c√°lculo diferencial - l√≠mites',
        dueDate: new Date('2025-09-21T23:59:59'),
        status: 'pending',
        priority: 'high',
        userId: teacher.id,
        subjectId: matematicas.id,
        groupId: group11A.id
      },
      {
        title: 'Ondas y Sonido',
        description: 'Laboratorio sobre propagaci√≥n de ondas sonoras',
        dueDate: new Date('2025-09-24T23:59:59'),
        status: 'pending',
        priority: 'medium',
        userId: teacher.id,
        subjectId: fisica.id,
        groupId: group11A.id
      },
      {
        title: 'Qu√≠mica Org√°nica Avanzada',
        description: 'S√≠ntesis de compuestos org√°nicos simples',
        dueDate: new Date('2025-09-27T23:59:59'),
        status: 'pending',
        priority: 'high',
        userId: teacher.id,
        subjectId: quimica.id,
        groupId: group11A.id
      }
    ];

    for (const taskData of tasks) {
      await Task.findOrCreate({
        where: {
          title: taskData.title,
          userId: taskData.userId,
          subjectId: taskData.subjectId,
          groupId: taskData.groupId
        },
        defaults: taskData
      });
    }

    console.log('‚úÖ Tareas creadas');
    console.log('üéâ Seed completado exitosamente!');
    console.log('');
    console.log('üìÖ Fechas de tareas creadas:');
    console.log('- 15/12/2024: 2 tareas (deber√≠a aparecer en rojo)');
    console.log('- 20/12/2024: 1 tarea (deber√≠a aparecer en amarillo)');
    console.log('- 22/12/2024: 1 tarea (deber√≠a aparecer en amarillo)');
    console.log('- 10/01/2025: 1 tarea (deber√≠a aparecer en amarillo)');
    console.log('- 12/01/2025: 1 tarea (deber√≠a aparecer en amarillo)');
    console.log('- 15/01/2025: 1 tarea (deber√≠a aparecer en amarillo)');
    console.log('- 18/01/2025: 1 tarea (deber√≠a aparecer en amarillo)');

  } catch (error) {
    console.error('‚ùå Error durante el seed:', error);
  }
}

// Ejecutar el seed si se llama directamente
if (import.meta.url === `file://${process.argv[1]}`) {
  seedTeacherData().then(() => {
    process.exit(0);
  }).catch((error) => {
    console.error('Error:', error);
    process.exit(1);
  });
}

export default seedTeacherData;